<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="count-down.css">
</head>
<body>
<div class="timer">
    <div class="timer_controls">
                <button data-time="20" class="timer__button">20 secs</button>
                <button data-time="300" class="timer__button" >Work 5</button>
                <button data-time="900" class="timer__button" >Quick 15</button>
                <button data-time="1200" class="timer__button" >Snack 20</button>
                <button data-time="3600" class="timer__button" >Lunch Break</button>
        <form action="" name="customForm" id="custom">
            <input type="text" name="minutes" placeholder="Enter Minutes">
        </form> 
    </div>
    <div class="display">
        <h1 class="display__time-left"></h1>
       <p class="display__end-time"></p>
    </div>
</div>


<script>
    let countDown ;
    const timerDisplay = document.querySelector('.display__time-left');
    const endTime = document.querySelector('.display__end-time');
    const buttons = document.querySelectorAll('[data-time]');


    function timer(seconds) {
// clear any existing items
  clearInterval(countDown);

    const now = Date.now();
    const then = now + seconds * 1000 ;
    displayTimeLeft(seconds);
    displayEndTime(then);
   countDown =  setInterval(() =>{
        const secondsLeft = Math.round((then - Date.now()) / 1000);
        console.log(secondsLeft);
        if (secondsLeft < 0) {
            clearInterval(countDown);
            return;
        }
        displayTimeLeft(secondsLeft);
    }, 1000);
    }

    function displayTimeLeft(seconds){
        const minutes = Math.floor(seconds / 60);
        const remainderSeconds = seconds % 60;
        const display = `${minutes}:${remainderSeconds < 10 ? '0' : ''}${remainderSeconds}`;
        document.title = display;
        timerDisplay.textContent = display;
    }

    function displayEndTime(timestamp) {
     const end = new Date(timestamp);
     const hour = end.getHours();
     const adjustedHour = hour > 12 ? hour - 12 : hour;
     const minutes = end.getMinutes(); 
     endTime.textContent = `Be Back At ${adjustedHour}:${minutes < 10 ? '0' : ''}${minutes}`         
    }
 
function startTimer() {
  const seconds = parseInt(this.dataset.time);
  timer(seconds);  
}

buttons.forEach(buttons => buttons.addEventListener("click", startTimer))
document.customForm.addEventListener('submit', function(e){
    e.preventDefault();
    const mins = this.minutes.value;
    timer(mins * 60);
    this.reset();
})
minutes.forEach(minutes => minutes.addEventListener("click", startTimer))
document.minutes.addEventListener('submit', function(e){
    e.preventDefault();
    const mins = this.minutes.value;
    timer(mins * 60);
    this.reset();
})

</script>  
</body>
</html>